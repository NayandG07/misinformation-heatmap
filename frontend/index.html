<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time misinformation heatmap for India - Track and visualize misinformation patterns across Indian states">
    <meta name="keywords" content="misinformation, heatmap, India, fact-check, real-time, satellite validation">
    <title>India Misinformation Heatmap - Real-time Tracking</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
    <link rel="preload" href="data/india-states.geojson" as="fetch" crossorigin="anonymous">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-container">
            <div class="header-left">
                <h1 class="header-title">
                    <span class="title-main">India Misinformation Heatmap</span>
                    <span class="title-subtitle">Real-time Tracking & Analysis</span>
                </h1>
            </div>
            
            <div class="header-right">
                <div class="status-indicator" id="connection-status" aria-live="polite">
                    <span class="status-dot" id="status-dot"></span>
                    <span class="status-text" id="status-text">Connecting...</span>
                </div>
                
                <button class="header-btn" id="info-btn" aria-label="Show information about this application">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                    </svg>
                </button>
                
                <button class="header-btn" id="settings-btn" aria-label="Open settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">
        <!-- Control Panel -->
        <aside class="control-panel" id="control-panel" role="complementary" aria-label="Map controls and filters">
            <div class="control-panel-header">
                <h2 class="control-panel-title">Controls</h2>
                <button class="panel-toggle" id="panel-toggle" aria-label="Toggle control panel">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                    </svg>
                </button>
            </div>
            
            <div class="control-panel-content" id="panel-content">
                <!-- Time Range Filter -->
                <div class="control-group">
                    <label for="time-range" class="control-label">Time Range</label>
                    <select id="time-range" class="control-select" aria-describedby="time-range-help">
                        <option value="1">Last 1 hour</option>
                        <option value="6">Last 6 hours</option>
                        <option value="24" selected>Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                    </select>
                    <small id="time-range-help" class="control-help">Select time period for data analysis</small>
                </div>

                <!-- Search Filter -->
                <div class="control-group">
                    <label for="search-filter" class="control-label">Search States</label>
                    <div class="search-container">
                        <input type="text" id="search-filter" class="control-input" 
                               placeholder="Search Indian states..." 
                               aria-describedby="search-help">
                        <button class="search-clear" id="search-clear" aria-label="Clear search" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    <small id="search-help" class="control-help">Search and highlight specific states</small>
                </div>

                <!-- Category Filter -->
                <div class="control-group">
                    <label for="category-filter" class="control-label">Category Filter</label>
                    <select id="category-filter" class="control-select" aria-describedby="category-help">
                        <option value="all" selected>All Categories</option>
                        <option value="health">Health</option>
                        <option value="politics">Politics</option>
                        <option value="social">Social</option>
                        <option value="economic">Economic</option>
                        <option value="environmental">Environmental</option>
                    </select>
                    <small id="category-help" class="control-help">Filter by misinformation category</small>
                </div>

                <!-- Intensity Threshold -->
                <div class="control-group">
                    <label for="intensity-threshold" class="control-label">
                        Minimum Intensity: <span id="intensity-value">0.0</span>
                    </label>
                    <input type="range" id="intensity-threshold" class="control-range" 
                           min="0" max="1" step="0.1" value="0" 
                           aria-describedby="intensity-help">
                    <small id="intensity-help" class="control-help">Show states above this intensity level</small>
                </div>

                <!-- Auto-refresh Toggle -->
                <div class="control-group">
                    <label class="control-checkbox-label">
                        <input type="checkbox" id="auto-refresh" class="control-checkbox" checked>
                        <span class="checkbox-custom"></span>
                        Auto-refresh data
                    </label>
                    <small class="control-help">Automatically update every 30 seconds</small>
                </div>

                <!-- Legend -->
                <div class="control-group">
                    <h3 class="legend-title">Intensity Scale</h3>
                    <div class="legend" role="img" aria-label="Heatmap intensity scale">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2E8B57;"></div>
                            <span class="legend-text">Low (0.0 - 0.3)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFD700;"></div>
                            <span class="legend-text">Medium (0.3 - 0.6)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF6347;"></div>
                            <span class="legend-text">High (0.6 - 0.8)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #DC143C;"></div>
                            <span class="legend-text">Critical (0.8 - 1.0)</span>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="control-group">
                    <h3 class="stats-title">Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total Events</span>
                            <span class="stat-value" id="total-events">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Active States</span>
                            <span class="stat-value" id="active-states">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Last Updated</span>
                            <span class="stat-value" id="last-updated">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg. Risk</span>
                            <span class="stat-value" id="avg-risk">-</span>
                        </div>
                    </div>
                    
                    <!-- Real-time indicators -->
                    <div class="realtime-indicators">
                        <div class="indicator-item">
                            <span class="indicator-label">Data Freshness</span>
                            <span class="data-freshness fresh" id="data-freshness">Live</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-label">Connection</span>
                            <span class="connection-quality excellent" id="connection-quality">Excellent</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-label">Next Update</span>
                            <span class="refresh-indicator" id="refresh-indicator">30s</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="control-group">
                    <h3 class="stats-title">Quick Actions</h3>
                    <div class="quick-actions">
                        <button class="quick-action-btn" id="refresh-now" aria-label="Refresh data now">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            <span>Refresh</span>
                        </button>
                        
                        <button class="quick-action-btn" id="reset-view" aria-label="Reset map view">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span>Reset View</span>
                        </button>
                        
                        <button class="quick-action-btn" id="export-data" aria-label="Export current data">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            <span>Export</span>
                        </button>
                        
                        <button class="quick-action-btn" id="fullscreen-toggle" aria-label="Toggle fullscreen">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                            </svg>
                            <span>Fullscreen</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Map Container -->
        <div class="map-container">
            <div id="map" class="map" role="application" aria-label="Interactive heatmap of India showing misinformation intensity by state"></div>
            
            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading-spinner" aria-label="Loading data">
                    <div class="spinner"></div>
                    <p class="loading-text">Loading heatmap data...</p>
                </div>
            </div>

            <!-- Error Overlay -->
            <div class="error-overlay" id="error-overlay" style="display: none;">
                <div class="error-content">
                    <svg class="error-icon" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <h3 class="error-title">Unable to Load Data</h3>
                    <p class="error-message" id="error-message">Please check your connection and try again.</p>
                    <button class="error-retry-btn" id="error-retry">Retry</button>
                </div>
            </div>
        </div>
    </main>

    <!-- State Detail Modal -->
    <div class="modal-overlay" id="state-modal-overlay" style="display: none;" role="dialog" aria-labelledby="modal-title" aria-modal="true">
        <div class="modal" id="state-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">State Details</h2>
                <button class="modal-close" id="modal-close" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-content" id="modal-content">
                <!-- Content will be dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="info-modal-overlay" style="display: none;" role="dialog" aria-labelledby="info-modal-title" aria-modal="true">
        <div class="modal" id="info-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="info-modal-title">About This Application</h2>
                <button class="modal-close" id="info-modal-close" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-content">
                <div class="info-section">
                    <h3>Real-time Misinformation Tracking</h3>
                    <p>This application provides real-time visualization of misinformation patterns across Indian states using advanced NLP analysis and satellite validation.</p>
                </div>
                
                <div class="info-section">
                    <h3>How It Works</h3>
                    <ul>
                        <li><strong>Data Collection:</strong> Monitors news sources and social media for potential misinformation</li>
                        <li><strong>NLP Analysis:</strong> Uses IndicBERT transformer to analyze content in multiple Indian languages</li>
                        <li><strong>Satellite Validation:</strong> Cross-references claims with satellite imagery when applicable</li>
                        <li><strong>Risk Scoring:</strong> Calculates misinformation risk based on virality and reality scores</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h3>Understanding the Heatmap</h3>
                    <ul>
                        <li><strong>Green:</strong> Low misinformation activity</li>
                        <li><strong>Yellow:</strong> Moderate activity requiring attention</li>
                        <li><strong>Orange:</strong> High activity with significant risk</li>
                        <li><strong>Red:</strong> Critical levels requiring immediate attention</li>
                    </ul>
                </div>
                
                <div class="info-section">
                    <h3>Data Sources</h3>
                    <p>Data is collected from verified news sources, social media platforms, and cross-validated using satellite imagery analysis. All processing respects privacy and focuses on public information patterns.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal-overlay" style="display: none;" role="dialog" aria-labelledby="settings-modal-title" aria-modal="true">
        <div class="modal" id="settings-modal">
            <div class="modal-header">
                <h2 class="modal-title" id="settings-modal-title">Settings</h2>
                <button class="modal-close" id="settings-modal-close" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-content">
                <div class="settings-group">
                    <h3>Display Preferences</h3>
                    
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="dark-mode" class="settings-checkbox">
                        <span class="checkbox-custom"></span>
                        Dark mode
                    </label>
                    
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="high-contrast" class="settings-checkbox">
                        <span class="checkbox-custom"></span>
                        High contrast mode
                    </label>
                    
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="reduce-motion" class="settings-checkbox">
                        <span class="checkbox-custom"></span>
                        Reduce animations
                    </label>
                </div>
                
                <div class="settings-group">
                    <h3>Data Preferences</h3>
                    
                    <label for="refresh-interval" class="settings-label">
                        Refresh Interval (seconds)
                    </label>
                    <select id="refresh-interval" class="settings-select">
                        <option value="15">15 seconds</option>
                        <option value="30" selected>30 seconds</option>
                        <option value="60">1 minute</option>
                        <option value="300">5 minutes</option>
                    </select>
                    
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="show-notifications" class="settings-checkbox" checked>
                        <span class="checkbox-custom"></span>
                        Show update notifications
                    </label>
                </div>
                
                <div class="settings-group">
                    <h3>Accessibility</h3>
                    
                    <label for="font-size" class="settings-label">
                        Font Size
                    </label>
                    <select id="font-size" class="settings-select">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                        <option value="extra-large">Extra Large</option>
                    </select>
                    
                    <label class="settings-checkbox-label">
                        <input type="checkbox" id="screen-reader-mode" class="settings-checkbox">
                        <span class="checkbox-custom"></span>
                        Enhanced screen reader support
                    </label>
                </div>
                
                <div class="settings-actions">
                    <button class="settings-btn settings-btn-secondary" id="reset-settings">Reset to Defaults</button>
                    <button class="settings-btn settings-btn-primary" id="save-settings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>